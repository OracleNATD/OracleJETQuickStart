/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojmodel"],function(a){a.vg=function(a,b,c,d,e){this.ON=a;this.gb=b;this.PX=[];this.uG=c;this.start=d<b.length?d:b.length-1;this.count=-1===e?b.length:Math.min(b.length,e)};o_("CollectionNodeSet",a.vg,a);a.vg.prototype.Z_=function(a){this.E6(this).then(function(){a.success&&a.success()})};a.vg.prototype.E6=function(a){return new Promise(function(b){function c(e){e<d?a.Ika(e,{success:function(b){null!==b?a.E6(b).then(function(){c(e+1)}):c(e+
1)}}):b(void 0)}var d=a.getCount();c(0)})};a.vg.prototype.Ika=function(a,b){var c=this.gb.at(a);if(this.uG.TA(c).leaf)this.PX[a]=null,b.success(null);else{var d=this.uG.EG(c),c=this.uG.TA(c).key,e=this;this.uG.kB(d,0,-1,{success:function(c){e.PX[a]=c;b.success(c)}},c)}};a.vg.prototype.getParent=function(){return this.ON};a.b.g("CollectionNodeSet.prototype.getParent",{getParent:a.vg.prototype.getParent});a.vg.prototype.getStart=function(){return this.start};a.b.g("CollectionNodeSet.prototype.getStart",
{getStart:a.vg.prototype.getStart});a.vg.prototype.getCount=function(){return this.count};a.b.g("CollectionNodeSet.prototype.getCount",{getCount:a.vg.prototype.getCount});a.vg.prototype.getData=function(a){this.DR(a);return this.gb.at(a).attributes};a.b.g("CollectionNodeSet.prototype.getData",{getData:a.vg.prototype.getData});a.vg.prototype.DR=function(a){if(a<this.start||a>this.start+this.count)throw"Out of range";};a.vg.prototype.getMetadata=function(a){this.DR(a);var b={};a=this.gb.at(a);a=this.uG.TA(a);
b.key=a.key;b.leaf=a.leaf;b.depth=a.depth;return b};a.b.g("CollectionNodeSet.prototype.getMetadata",{getMetadata:a.vg.prototype.getMetadata});a.vg.prototype.vi=function(a){this.DR(a);return this.PX[a]};a.b.g("CollectionNodeSet.prototype.getChildNodeSet",{vi:a.vg.prototype.vi});a.pb=function(g){g=g||{};this.mG=g.root;this.$Fa=g.childCollectionCallback;this.TA=g.parseMetadata;this.mx=null;this.bB="none";this.Rf={};a.pb.u.constructor.call(this)};o_("CollectionTreeDataSource",a.pb,a);a.pb.prototype.TA=
function(a){return{key:a.idAttribute+"\x3d"+a.id}};a.b.sa(a.pb,a.Ju,"oj.CollectionTreeDataSource");a.pb.prototype.Init=function(){a.pb.u.Init.call(this)};a.b.g("CollectionTreeDataSource.prototype.Init",{Init:a.pb.prototype.Init});a.pb.prototype.yh=function(a){var b=this.Rf[a];if(b&&0<b.length)return b.length;this.sY(a,{success:function(a){return a.length}});return-1};a.b.g("CollectionTreeDataSource.prototype.getChildCount",{yh:a.pb.prototype.yh});a.pb.prototype.sY=function(a,b){this.si(a,null,{success:function(a){b.success(a.gb)},
error:b.error})};a.b.g("CollectionTreeDataSource.prototype.getChildCollection",{sY:a.pb.prototype.sY});a.pb.prototype.si=function(a,b,c){b=b||{};var d=b.start?b.start:0,e=b.count?b.count:-1;if(null===a)this.kB(null,d,e,c,null);else{var f=this;this.uT(this.mG,a,0).then(function(b){if(b){b=f.EG(b.au);try{f.kB(b,d,e,c,a)}catch(k){c&&c.error&&c.error({status:k.message})}}else c&&c.error&&c.error(a)})}};a.b.g("CollectionTreeDataSource.prototype.fetchChildren",{si:a.pb.prototype.si});a.pb.prototype.fla=
function(a,b,c){var d=0;c&&c.at&&(d=c.at);b=this.BJ(b);a=this.sI(this,"insert",d,b,this.cba(null!=b&&0<b.length?b[b.length-1]:null,a));this.handleEvent("change",a)};a.pb.prototype.gla=function(a,b,c){var d=0;c&&c.index&&(d=c.index);this.IBa(a);a=this.sI(this,"delete",d,this.BJ(b),null);this.handleEvent("change",a)};a.pb.prototype.hla=function(a){var b=this.Vta(a),c=null,d=null;b&&(c=b.index,d=this.BJ(b.gb));a=this.sI(this,"update",c,d,this.cba(null!=d&&0<d.length?d[d.length-1]:null,a));this.handleEvent("change",
a)};a.pb.prototype.xka=function(a){a=this.sI(this,"refresh",null,this.BJ(a),null);this.handleEvent("refresh",a)};a.pb.prototype.cba=function(g,b){var c=new a.l;c.add(b);return this.d8(c,g,0,1)};a.pb.prototype.BJ=function(g){var b=[],c=null;do c=this.ava(g),null!==c&&(c!==a.pb.E0&&b.unshift(c),g=this.Wta(c));while(null!=c);return b};a.pb.E0="%!@ROOT%#@!";a.pb.prototype.bJ=function(g){var b=g instanceof a.D?this.TA(g).key:g;return g?b:a.pb.E0};a.pb.prototype.w3=function(a){return this.Rf[this.bJ(a)]};
a.pb.prototype.yca=function(g,b){b.on(a.ka.O.ADD,this.fla,this);b.on(a.ka.O.REMOVE,this.gla,this);b.on(a.ka.O.CHANGE,this.hla,this);b.on(a.ka.O.SYNC,this.xka,this);this.Rf[this.bJ(g)]=b};a.pb.prototype.IBa=function(a){a=this.bJ(a);for(var b in this.Rf)if(this.Rf.hasOwnProperty(b)&&b===a){this.Rf[a].off(null,null,this);delete this.Rf[a];break}};a.pb.prototype.lza=function(a,b){for(var c=b.length,d=0;d<c;d++){var e=this.bJ(b.at(d));if(a===e)return!0}return!1};a.pb.prototype.Vta=function(a){for(var b in this.Rf)if(this.Rf.hasOwnProperty(b))for(var c=
this.Rf[b],d=0;d<c.length;d++)if(c.at(d)===a)return{index:d,gb:c};return null};a.pb.prototype.Wta=function(a){for(var b in this.Rf)if(this.Rf.hasOwnProperty(b)){var c=this.Rf[b];if(this.lza(a,c))return c}return null};a.pb.prototype.ava=function(a){for(var b in this.Rf)if(this.Rf.hasOwnProperty(b)&&this.Rf[b]===a)return b;return null};a.pb.prototype.EG=function(a){var b=!0,c=this.w3(a);c||(b=!1,c=this.$Fa(this.mG,a),null!=c&&(this.Y3(c),this.yca(a,c)));return{gb:c,LX:b}};a.pb.prototype.sI=function(a,
b,c,d,e){return{source:a,operation:b,index:c,parent:d,data:e}};a.pb.prototype.kB=function(a,b,c,d,e){var f=this;null===a&&((a=this.w3(null))?a={gb:a,LX:!0}:(a={gb:f.mG,LX:!1},f.yca(null,this.mG)));a&&f.B6(a,function(a){d.success&&d.success(f.d8(a,e,b,c))},d.error)};a.pb.prototype.d8=function(g,b,c,d){return new a.vg(b,g,this,c,d)};a.pb.prototype.HCa=function(a,b){var c=this;return new Promise(function(d){function e(a,b,g){a<b.length?b.at(a,{deferred:!0}).then(function(l){if(l){var m=c.TA(l);if(g===
m.key){d(l);return}}a++;e(a,b,g)}):d(null)}e(0,a,b)})};a.pb.prototype.uT=function(a,b,c){var d=this;return new Promise(function(e){d.HCa(a,b).then(function(f){function h(d,f){if(d<k){var r=f.EG(a.at(d));r.gb?f.B6(r,function(a){f.uT(a,b,c+1).then(function(a){a?e(a):(d++,h(d,f))})},null):(d++,h(d,f))}else e(null)}if(f)e({au:f,depth:c});else{var k=a.length;h(0,d)}})})};a.pb.prototype.B6=function(a,b,c){a.LX?b(a.gb):(this.mx&&"none"!==this.mx&&(a.gb.em=this.mx,a.gb.p_=this.bB),0<a.gb.length||!a.gb.Uka()?
b(a.gb):a.gb.fetch({success:function(a){b(a)},error:c}))};a.pb.prototype.gA=function(a,b){var c=this;null===a?this.kB(null,0,-1,{success:function(a){a.Z_({success:function(){b.success&&b.success(a)}})}},null):this.uT(this.mG,a,0).then(function(d){d&&(d=c.EG(d.au),c.kB(d,0,-1,{success:function(a){a.Z_({success:function(){b.success&&b.success(a)}})}},a))})};a.b.g("CollectionTreeDataSource.prototype.fetchDescendants",{gA:a.pb.prototype.gA});a.pb.prototype.sort=function(a,b){var c=a.key,d=a.direction,
e=!1;c!==this.mx&&(this.mx=c,e=!0);d!==this.bB&&(this.bB=d,e=!0);if(e){"none"===this.bB&&(this.Rf={});for(var f in this.Rf)this.Rf.hasOwnProperty(f)&&this.Y3(this.Rf[f])}b&&b.success&&b.success()};a.b.g("CollectionTreeDataSource.prototype.sort",{sort:a.pb.prototype.sort});a.pb.prototype.Y3=function(a){a.comparator=this.mx;a.sortDirection="ascending"===this.bB?1:-1;a.sort()};a.pb.prototype.hr=function(){return{key:this.mx,direction:this.bB}};a.b.g("CollectionTreeDataSource.prototype.getSortCriteria",
{hr:a.pb.prototype.hr});a.pb.prototype.move=function(){a.o.kd()};a.b.g("CollectionTreeDataSource.prototype.move",{move:a.pb.prototype.move});a.pb.prototype.moveOK=function(){return"invalid"};a.b.g("CollectionTreeDataSource.prototype.moveOK",{moveOK:a.pb.prototype.moveOK});a.pb.prototype.getCapability=function(a){return"sort"===a?"default":"move"===a?"none":"batchFetch"===a||"fetchDescendants"===a?"disable":null};a.b.g("CollectionTreeDataSource.prototype.getCapability",{getCapability:a.pb.prototype.getCapability})});