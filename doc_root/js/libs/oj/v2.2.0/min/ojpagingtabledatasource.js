/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a){a.Ba=function(g){if(!(g instanceof a.V))throw Error(a.V.od._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+a.V.od._ERR_DATA_INVALID_TYPE_DETAIL);this.Od=g;this.pa=0;this.Rk=-1;this.Init()};o_("PagingTableDataSource",a.Ba,a);a.b.sa(a.Ba,a.V,"oj.PagingTableDataSource");a.Ba.prototype.Init=function(){a.Ba.u.Init.call(this)};a.b.g("PagingTableDataSource.prototype.Init",{Init:a.Ba.prototype.Init});a.Ba.prototype.getWrappedDataSource=function(){return this.Od};
a.b.g("PagingTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:a.Ba.prototype.getWrappedDataSource});a.Ba.prototype.getPage=function(){return"loadMore"==this.RC?0:this.AJ()};a.b.g("PagingTableDataSource.prototype.getPage",{getPage:a.Ba.prototype.getPage});a.Ba.prototype.setPage=function(g,b){b=b||{};g=parseInt(g,10);try{a.Ba.u.handleEvent.call(this,a.bd.O.BEFOREPAGE,{page:g,previousPage:this.AJ()})}catch(c){return Promise.reject(null)}var d=this.AJ();this.yb=null!=b.pageSize?b.pageSize:
this.yb;b.pageSize=this.yb;b.startIndex=g*this.yb;this.pa=null==b.startIndex?this.pa:b.startIndex;this.RC="page";var e=this;return new Promise(function(c,g){0<e.yb?e.Od.fetch(b).then(function(b){b.startIndex=0;0<b.data.length?e.xw(e.pa+b.data.length-1,!0):e.xw(-1,!0);a.Ba.u.handleEvent.call(e,a.bd.O.PAGE,{page:e.AJ(),previousPage:d});c(null)},function(){e.pa=d*e.yb;g(null)}):c(null)})};a.b.g("PagingTableDataSource.prototype.setPage",{setPage:a.Ba.prototype.setPage});a.Ba.prototype.getStartItemIndex=
function(){return"loadMore"==this.RC?0:this.pa};a.b.g("PagingTableDataSource.prototype.getStartItemIndex",{getStartItemIndex:a.Ba.prototype.getStartItemIndex});a.Ba.prototype.getEndItemIndex=function(){return this.Rk};a.b.g("PagingTableDataSource.prototype.getEndItemIndex",{getEndItemIndex:a.Ba.prototype.getEndItemIndex});a.Ba.prototype.getPageCount=function(){var a=this.totalSize();return-1==a?-1:Math.ceil(a/this.yb)};a.b.g("PagingTableDataSource.prototype.getPageCount",{getPageCount:a.Ba.prototype.getPageCount});
a.Ba.prototype.at=function(a,b){return this.Od.at(a,b)};a.b.g("PagingTableDataSource.prototype.at",{at:a.Ba.prototype.at});a.Ba.prototype.fetch=function(a){a=a||{};if(null==a.startIndex)return this.setPage(this.getPage());this.RC="loadMore";this.pa=null==a.startIndex?this.pa:a.startIndex;var b=null==a.pageSize?this.yb:a.pageSize;null==this.yb&&(this.yb=b);a.pageSize=b;a.startIndex=this.pa;var c=this;return new Promise(function(d,e){0<b?c.Od.fetch(a).then(function(a){0<a.data.length?c.xw(c.pa+a.data.length-
1,!0):c.xw(-1,!0);d(a)},function(a){e(a)}):d(null)})};a.b.g("PagingTableDataSource.prototype.fetch",{fetch:a.Ba.prototype.fetch});a.Ba.prototype.get=function(a,b){return this.Od.get(a,b)};a.b.g("PagingTableDataSource.prototype.get",{get:a.Ba.prototype.get});a.Ba.prototype.getCapability=function(a){return this.Od.getCapability(a)};a.b.g("PagingTableDataSource.prototype.getCapability",{getCapability:a.Ba.prototype.getCapability});a.Ba.prototype.on=function(g,b){var c=this,d=this.Od;if(g==a.V.O.SYNC){var e=
function(a){c.Gxa(a,b)};d.on(g,e)}else if(g==a.V.O.ADD||g==a.V.O.REMOVE||g==a.V.O.CHANGE)e=function(a){c.txa(a,b)},d.on(g,e);else if(g==a.V.O.REFRESH||g==a.V.O.RESET)e=function(a){c.pa=0;b(a)},d.on(g,e);else if(g==a.bd.O.PAGE||g==a.bd.O.BEFOREPAGE||g==a.bd.O.PAGECOUNT)a.Ba.u.on.call(this,g,b);else d.on(g,b)};a.b.g("PagingTableDataSource.prototype.on",{on:a.Ba.prototype.on});a.Ba.prototype.off=function(g,b){g!=a.bd.O.PAGE&&g!=a.bd.O.PAGECOUNT||a.Ba.u.off.call(this,g,b);this.Od.off(g,b)};a.b.g("PagingTableDataSource.prototype.off",
{off:a.Ba.prototype.off});a.Ba.prototype.sort=function(a){null==a?a=this.sortCriteria:this.sortCriteria=a;return this.Od.sort(a)};a.b.g("PagingTableDataSource.prototype.sort",{sort:a.Ba.prototype.sort});a.Ba.prototype.totalSize=function(){return this.Od.totalSize()};a.b.g("PagingTableDataSource.prototype.totalSize",{totalSize:a.Ba.prototype.totalSize});a.Ba.prototype.totalSizeConfidence=function(){return this.Od.totalSizeConfidence()};a.b.g("PagingTableDataSource.prototype.totalSizeConfidence",{totalSizeConfidence:a.Ba.prototype.totalSizeConfidence});
a.Ba.prototype.AJ=function(){return 0<this.yb?Math.floor(this.pa/this.yb):0};a.Ba.prototype.txa=function(a,b){var c=[],d;for(d=0;d<a.indexes.length;d++){var e=a.indexes[d];void 0!==e&&("page"==this.RC&&(e-=this.pa),(0>e||e>=this.pa+this.yb)&&c.push(d))}if(0<c.length)for(c.sort(function(a,b){return a-b}),d=c.length-1;0<=d;d--)a.data.splice(c[d],1),a.indexes.splice(c[d],1),a.keys.splice(c[d],1);0<a.indexes.length&&this.xw(a.indexes[a.indexes.length-1],!1);a.startIndex=this.pa;b(a)};a.Ba.prototype.Gxa=
function(g,b){g.startIndex!=this.pa&&(this.pa=g.startIndex);0<g.data.length?this.xw(g.startIndex+g.data.length-1,!0):this.xw(-1,!0);if("page"==this.RC){var c={};a.Xc.vf(c,g);c.startIndex=0;b(c)}else b(g)};a.Ba.prototype.xw=function(a,b){this.Rk=b?a:a>this.Rk?a:this.Rk;var c=this.totalSize();0<c&&(this.Rk=this.Rk>c-1?c-1:this.Rk)};a.Ba.O={ADD:"add",REMOVE:"remove",RESET:"reset",SYNC:"sync",REFRESH:"refresh",SORT:"sort"};o_("PagingTableDataSource.EventType",a.Ba.O,a);a.bd=function(){};o_("PagingModel",
a.bd,a);a.bd.prototype.getPage=function(){};a.b.g("PagingModel.prototype.getPage",{getPage:a.bd.prototype.getPage});a.bd.prototype.setPage=function(){};a.b.g("PagingModel.prototype.setPage",{setPage:a.bd.prototype.setPage});a.bd.prototype.getStartItemIndex=function(){};a.b.g("PagingModel.prototype.getStartItemIndex",{getStartItemIndex:a.bd.prototype.getStartItemIndex});a.bd.prototype.getEndItemIndex=function(){};a.b.g("PagingModel.prototype.getEndItemIndex",{getEndItemIndex:a.bd.prototype.getEndItemIndex});
a.bd.prototype.getPageCount=function(){};a.b.g("PagingModel.prototype.getPageCount",{getPageCount:a.bd.prototype.getPageCount});a.bd.prototype.totalSize=function(){};a.b.g("PagingModel.prototype.totalSize",{totalSize:a.bd.prototype.totalSize});a.bd.prototype.totalSizeConfidence=function(){};a.b.g("PagingModel.prototype.totalSizeConfidence",{totalSizeConfidence:a.bd.prototype.totalSizeConfidence});a.bd.O={BEFOREPAGE:"beforePage",PAGE:"page",PAGECOUNT:"pageCount"};o_("PagingModel.EventType",a.bd.O,
a)});