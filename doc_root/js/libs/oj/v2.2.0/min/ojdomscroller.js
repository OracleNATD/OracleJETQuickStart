/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery"],function(a,g){a.Gf=function(a,c,d){d=d||{};this.i=c;this.pv=g(a)[0];this.Ky=d.fetchSize;this.Ky=0<this.Ky?this.Ky:25;this.qz=d.maxCount;this.qz=0<this.qz?this.qz:500;this.Yo=0;this.yda=d.success;this.$sa=d.error;this.fw();this.qv=d.fetchTrigger;if(null==this.qv||isNaN(this.qv))this.qv=0;this.uya=this.pv.scrollTop;g(this.u8()).on("scroll.domscroller",function(){var a=this.pv,b=this.kva(a),a=a.scrollHeight-a.clientHeight;0<a&&this.pU(b,a)}.bind(this))};a.Gf.prototype.u8=
function(){return this.pv==document.body||this.pv==document.documentElement?window:this.pv};a.Gf.WFa=function(a,c){for(var d=0,e=c;e&&e!=a&&g.contains(a,e);)d+=e.offsetTop,e=e.offsetParent;return d};a.Gf.prototype.kva=function(a){var c=this.qv;return a==document.documentElement&&(void 0===this.gea&&(this.gea=this.uya==a.scrollTop?!0:!1),this.gea)?c+document.body.scrollTop:c+a.scrollTop};a.Gf.prototype.destroy=function(){this.fp();g(this.u8()).off("scroll.domscroller")};a.b.g("DomScroller.prototype.destroy",
{destroy:a.Gf.prototype.destroy});a.Gf.prototype.checkViewport=function(){return 0<this.pv.clientHeight&&!this.tqa()?this.G6():Promise.resolve(null)};a.b.g("DomScroller.prototype.checkViewport",{checkViewport:a.Gf.prototype.checkViewport});a.Gf.prototype.pU=function(a,c){if(1>=c-a&&!this.QC){var d=this;this.G6().then(function(a){null!=d.yda&&d.yda(a)},this.$sa)}};a.Gf.prototype.tqa=function(){var a=this.pv;return a.scrollHeight>a.clientHeight+this.qv?!0:!1};a.Gf.prototype.G6=function(){if(this.QC)return this.QC;
var a=this.qz-this.Yo;if(0<a){var c=this.Ky,d=this;a<this.Ky&&(c=a);var e=this.lta({pageSize:c});return this.QC=new Promise(function(c){e.then(function(e){d.QC=null;null!=e&&0<e.data.length&&(d.Yo=e.data.length+e.startIndex,a<d.Ky&&(e.maxCount=d.qz,e.maxCountLimit=!0));c(e)})})}return Promise.resolve({maxCount:this.qz,maxCountLimit:!0})};a.Gf.prototype.lta=function(a){a=a||{};var c=a.pageSize;this.Vi=this.Vi?this.Vi+c:c;if(-1==this.i.totalSize()||this.i.totalSize()>this.Vi){var d=this;return new Promise(function(a,
b){d.i.fetch({startIndex:d.Vi,pageSize:c}).then(function(b){a(b)},function(){b(null)})})}return Promise.resolve()};a.Gf.prototype.Ns=function(){this.Vi=null;this.Yo=0};a.Gf.prototype.bwa=function(a){this.Vi=a.startIndex;0<a.data.length&&(this.Yo=a.data.length+this.Vi)};a.Gf.prototype.Z8=function(b){return function(c){c=c||{};c=c.indexes;var d,e=c.length;for(d=0;d<e;d++){var f=c[d];void 0!==f&&0<this.Yo&&f<=this.Yo&&(b==a.V.O.ADD?this.Yo+=1:b==a.V.O.REMOVE&&(this.Yo-=1))}}};a.Gf.prototype.fw=function(){var b=
this.i;if(null!=b){this.fp();this.xb=[];this.xb.push({eventType:a.V.O.SORT,eventHandler:this.Ns.bind(this)});this.xb.push({eventType:a.V.O.REFRESH,eventHandler:this.Ns.bind(this)});this.xb.push({eventType:a.V.O.RESET,eventHandler:this.Ns.bind(this)});this.xb.push({eventType:a.V.O.SYNC,eventHandler:this.bwa.bind(this)});this.xb.push({eventType:a.V.O.ADD,eventHandler:this.Z8(a.V.O.ADD).bind(this)});this.xb.push({eventType:a.V.O.REMOVE,eventHandler:this.Z8(a.V.O.REMOVE).bind(this)});var c,d;for(c=0;c<
this.xb.length;c++)(d=b.on(this.xb[c].eventType,this.xb[c].eventHandler))&&(this.xb[c].eventHandler=d)}};a.Gf.prototype.fp=function(){var a=this.i;if(null!=this.xb&&null!=a){var c;for(c=0;c<this.xb.length;c++)a.off(this.xb[c].eventType,this.xb[c].eventHandler)}}});