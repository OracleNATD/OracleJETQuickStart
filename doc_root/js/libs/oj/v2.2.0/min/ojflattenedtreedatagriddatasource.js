/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common","ojs/ojrowexpander"],function(a){a.Jh=function(g,b,c,d,e){a.o.bF(c);this.fd=g;this.rg=b;this.tN=c;this.rc=d;this.oa=e};o_("FlattenedTreeHeaderSet",a.Jh,a);a.Jh.prototype.getData=function(g,b){var c;a.o.assert(g<=this.rg&&g>=this.fd,"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return null!=this.oa&&null!=this.rc?(c=this.rc.getData(g-this.fd+this.rc.getStart()),null!=c?c.get?c.get(this.oa):c[this.oa]:null):this.tN[g]};
a.b.g("FlattenedTreeHeaderSet.prototype.getData",{getData:a.Jh.prototype.getData});a.Jh.prototype.getMetadata=function(g,b){a.o.assert(g<=this.rg&&g>=this.fd,"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return null!=this.oa&&null!=this.rc?this.rc.getMetadata(g-this.fd+this.rc.getStart()):{key:this.getData(g)}};a.b.g("FlattenedTreeHeaderSet.prototype.getMetadata",{getMetadata:a.Jh.prototype.getMetadata});a.Jh.prototype.getCount=function(){return null!=this.oa&&null!=this.rc?
Math.min(this.rc.getCount(),this.rg-this.fd):Math.max(0,this.rg-this.fd)};a.b.g("FlattenedTreeHeaderSet.prototype.getCount",{getCount:a.Jh.prototype.getCount});a.Jh.prototype.getLevelCount=function(){return 0<this.getCount()?1:0};a.b.g("FlattenedTreeHeaderSet.prototype.getLevelCount",{getLevelCount:a.Jh.prototype.getLevelCount});a.Jh.prototype.getExtent=function(g,b){a.o.assert(g<=this.rg&&g>=this.fd,"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return{extent:1,more:{before:!1,
after:!1}}};a.b.g("FlattenedTreeHeaderSet.prototype.getExtent",{getExtent:a.Jh.prototype.getExtent});a.Jh.prototype.getDepth=function(g,b){a.o.assert(g<=this.rg&&g>=this.fd,"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return 1};a.b.g("FlattenedTreeHeaderSet.prototype.getDepth",{getDepth:a.Jh.prototype.getDepth});a.xl=function(g,b,c,d,e,f){a.o.bF(f);this.za=g;this.kb=b;this.Jp=c;this.Tw=d;this.rc=e;this.Tf=f};o_("FlattenedTreeCellSet",a.xl,a);a.xl.prototype.getData=function(g){var b,
c,d,e;b=this.o8(g);if(null==b)return null;g=b[0];b=b[1];a.o.assert(g<this.rc.getStart()+this.rc.getCount()&&b<this.Tf.length);c=this.Tf[b];d=this.rc.getData(g);return null!=d?(g={},b=d.get?function(){return d.get(c)}:function(){return d[c]},e=d.set?function(a){return d.set(c,a)}:function(a){d[c]=a},Object.defineProperty(g,"data",{get:b,set:e}),g):null};a.b.g("FlattenedTreeCellSet.prototype.getData",{getData:a.xl.prototype.getData});a.xl.prototype.getMetadata=function(g){var b;b=this.o8(g);if(null==
b)return null;g=b[0];b=b[1];a.o.assert(g<this.rc.getStart()+this.rc.getCount()&&b<this.Tf.length);b=this.Tf[b];g=this.rc.getMetadata(g);g.keys={row:g.key,column:b};return g};a.b.g("FlattenedTreeCellSet.prototype.getMetadata",{getMetadata:a.xl.prototype.getMetadata});a.xl.prototype.o8=function(g){var b;a.o.oi(g);if(null==this.rc||0==this.rc.length)return null;b=g.row-this.za+this.rc.getStart();g=g.column;a.o.Qq(b,null);a.o.Qq(g,null);a.o.assert(0<=b&&0<=g);return[b,g]};a.xl.prototype.getStart=function(a){return"row"===
a?this.za:"column"===a?this.Jp:0};a.b.g("FlattenedTreeCellSet.prototype.getStart",{getStart:a.xl.prototype.getStart});a.xl.prototype.getCount=function(a){return"row"===a?Math.min(this.kb-this.za,this.rc.getCount()):"column"===a?this.Tw-this.Jp:0};a.b.g("FlattenedTreeCellSet.prototype.getCount",{getCount:a.xl.prototype.getCount});a.Bb=function(g,b){a.Bb.u.constructor.call(this,g,b)};o_("FlattenedTreeDataGridDataSource",a.Bb,a);a.b.sa(a.Bb,a.va,"oj.FlattenedTreeDataGridDataSource");a.Bb.prototype.Init=
function(){a.Bb.u.Init.call(this);this.Tf=a.Bb.u.qF.call(this,"columns");this.oa=a.Bb.u.qF.call(this,"rowHeader")};a.b.g("FlattenedTreeDataGridDataSource.prototype.Init",{Init:a.Bb.prototype.Init});a.Bb.prototype.getCountPrecision=function(a){return"row"===a?"estimate":"actual"};a.b.g("FlattenedTreeDataGridDataSource.prototype.getCountPrecision",{getCountPrecision:a.Bb.prototype.getCountPrecision});a.Bb.prototype.getCount=function(a){return"row"===a?-1:"column"===a?this.Tf.length:0};a.b.g("FlattenedTreeDataGridDataSource.prototype.getCount",
{getCount:a.Bb.prototype.getCount});a.Bb.prototype.fetchHeaders=function(g,b,c){var d,e;d=g.axis;if("column"===d)d=g.start+g.count,d>this.getCount("column")&&(d=this.getCount("column")-g.start),e=new a.Jh(g.start,d,this.Tf);else if("row"===d&&null!=this.oa){this.Gp={range:g,callbacks:b,callbackObjects:c};return}null!=b&&null!=b.success&&(null==c&&(c={}),b.success.call(c.success,e,g,null))};a.b.g("FlattenedTreeDataGridDataSource.prototype.fetchHeaders",{fetchHeaders:a.Bb.prototype.fetchHeaders});a.Bb.prototype.fetchCells=
function(g,b,c){var d,e,f,h;for(d=0;d<g.length;d++)if(e=g[d],"row"==e.axis){f=e.start;h=e.count;break}a.Bb.u.rp.call(this,{start:f,count:h},{success:function(a){this.hU(a,g,b,c,0)}.bind(this),error:function(a){this.swa(a,{start:f,count:h},b,c)}.bind(this)})};a.b.g("FlattenedTreeDataGridDataSource.prototype.fetchCells",{fetchCells:a.Bb.prototype.fetchCells});a.Bb.prototype.keys=function(g){var b,c;b=g.row;c=g.column;return new Promise(function(d){b>a.Bb.u.sHa.call(this).end||c>this.Tf.length?d(null):
d({row:a.Bb.u.getKey.call(this,b),column:this.Tf[c]})}.bind(this))};a.b.g("FlattenedTreeDataGridDataSource.prototype.keys",{keys:a.Bb.prototype.keys});a.Bb.prototype.indexes=function(g){var b,c,d,e,f;d=g.row;e=g.column;return new Promise(function(g){b=a.Bb.u.gl.call(this,d);for(f=0;f<this.Tf.length;f++)if(this.Tf[f]===e){c=f;break}0<=b||0<=c?g({row:b,column:c}):g(null)}.bind(this))};a.b.g("FlattenedTreeDataGridDataSource.prototype.indexes",{indexes:a.Bb.prototype.indexes});a.Bb.prototype.sort=function(g,
b,c){return a.Bb.u.getWrappedDataSource.call(this).sort(g,{success:function(){this.sU(b,c)}.bind(this),error:b.error})};a.b.g("FlattenedTreeDataGridDataSource.prototype.sort",{sort:a.Bb.prototype.sort});a.Bb.prototype.sU=function(a,b){this.refresh();a.success&&(null==b&&(b={}),a.success.call(b.success))};a.Bb.prototype.move=function(g,b,c,d){a.Bb.u.getWrappedDataSource.call(this).move(g,b,c,d)};a.b.g("FlattenedTreeDataGridDataSource.prototype.move",{move:a.Bb.prototype.move});a.Bb.prototype.getCapability=
function(g){return"default"===a.Bb.u.getWrappedDataSource.call(this).getCapability(g)?"column":"none"};a.b.g("FlattenedTreeDataGridDataSource.prototype.getCapability",{getCapability:a.Bb.prototype.getCapability});a.Bb.prototype.yF=function(g,b){a.Bb.u.yF.call(this,g,b)};a.Bb.prototype.hU=function(g,b,c,d){var e,f,h,k,l,m;for(e=0;e<b.length;e++)f=b[e],"row"==f.axis?(h=f.start,k=f.count):"column"==f.axis&&(l=f.start,m=f.count,l+m>this.getCount("column")&&(m=this.getCount("column")-l));this.Gp&&(e=this.Gp.range,
e.start==h&&e.count==k&&(this.nU(g,e,this.Gp.callbacks,this.Gp.callbackObjects),this.Gp=null));g=new a.xl(h,h+k,l,l+m,g,this.Tf);c.success&&(null==d&&(d={}),c.success.call(d.success,g,b))};a.Bb.prototype.swa=function(a,b,c,d){var e;this.Gp&&(e=this.Gp.range,e.start==b.start&&e.count==b.count&&(b=this.Gp.callbacks,e=this.Gp.callbackObjects,b.error&&(null==e&&(e={}),b.error.call(e.error,a))),this.Gp=null);c.error&&(null==d&&(d={}),c.success.call(d.error,a))};a.Bb.prototype.nU=function(g,b,c,d){g=new a.Jh(b.start,
b.start+b.count,this.Tf,g,this.oa);c.success&&(null==d&&(d={}),c.success.call(d.success,g,b,null))};a.Bb.prototype.YM=function(g,b,c){var d,e,f,h;d=null;this.oa&&(d=new a.Jh(g,g+c.getCount(),this.Tf,c,this.oa));b=new a.xl(g,g+c.getCount(),0,this.Tf.length,c,this.Tf);f=[];h=[];for(e=0;e<c.getCount();e++)f.push({row:this.Pj(g+e).key}),h.push({row:g+e,column:-1});g={source:this,operation:"insert"};g.result=b;d&&(g.header=d);g.keys=f;g.indexes=h;a.Bb.u.handleEvent.call(this,"change",g)};a.Bb.prototype.YN=
function(g){var b,c,d;b=[];d=[];for(c=0;c<g.length;c++)b.push({row:g[c].key}),d.push({row:g[c].index,column:-1});g={source:this,operation:"delete"};g.keys=b;g.indexes=d;a.Bb.u.handleEvent.call(this,"change",g)};a.Bb.prototype.SY=function(g,b){b.success.call(null,new a.dh(null,g.start))}});