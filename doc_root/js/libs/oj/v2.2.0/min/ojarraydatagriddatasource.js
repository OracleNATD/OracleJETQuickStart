/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(a){a.ib=function(g,b){if(!(g instanceof Array)&&"function"!=typeof g&&"function"!=typeof g.wNa)throw Error("_ERR_DATA_INVALID_TYPE_SUMMARY\n_ERR_DATA_INVALID_TYPE_DETAIL");this.kx=this.iva(b);null!=b&&(this.columns=b.columns,this.sortCriteria=b.initialSort);a.ib.u.constructor.call(this,g)};o_("ArrayDataGridDataSource",a.ib,a);a.b.sa(a.ib,a.Pr,"oj.ArrayDataGridDataSource");a.ib.prototype.Init=function(){null==this.columns&&(this.columns=
this.Zta(this.hm()));this.zya();"function"==typeof this.data&&this.data.subscribe(this.jEa.bind(this),null,"arrayChange");a.ib.u.Init.call(this)};a.b.g("ArrayDataGridDataSource.prototype.Init",{Init:a.ib.prototype.Init});a.ib.prototype.em=null;a.b.g("ArrayDataGridDataSource.prototype.comparator",{em:a.ib.prototype.em});a.ib.prototype.sortCriteria=null;a.b.g("ArrayDataGridDataSource.prototype.sortCriteria",{sortCriteria:a.ib.prototype.sortCriteria});a.ib.prototype.iva=function(a){if(null!=a&&null!=
a.rowHeader)if(a=a.rowHeader,"object"===typeof a){if(null!=a["default"]&&"none"==a["default"])return}else if(null!=a)return a;return"m_defaultIndex"};a.ib.prototype.zya=function(){var a;a=this.hm();for(this.Rw=0;this.Rw<a.length;this.Rw+=1)a[this.Rw].ojKey=this.Rw.toString()};a.ib.prototype.Zta=function(a){var b,c;if("number"!==typeof a.length||0===a.length)return[];c=[];for(b in a[0])a[0].hasOwnProperty(b)&&(void 0!=this.kx&&b==this.kx||c.push(b));return c};a.ib.prototype.getCount=function(a){return"row"===
a?this.kt():"column"===a?this.columns.length:0};a.b.g("ArrayDataGridDataSource.prototype.getCount",{getCount:a.ib.prototype.getCount});a.ib.prototype.getCountPrecision=function(){return"exact"};a.b.g("ArrayDataGridDataSource.prototype.getCountPrecision",{getCountPrecision:a.ib.prototype.getCountPrecision});a.ib.prototype.kT=function(a,b){var c;if("row"===a){if(void 0==this.kx)return null;if("m_defaultIndex"==this.kx)return this.FJ(b);c=this.hm();return c[b][this.kx]}if("column"===a)return this.columns[b]};
a.ib.prototype.yua=function(a,b){var c;if("row"===a)return{key:this.FJ(b)};if("column"===a)return c=this.kT(a,b),null!=this.sortCriteria&&this.sortCriteria.key===c?{key:this.kT(a,b),sortDirection:this.sortCriteria.direction}:{key:c}};a.ib.prototype.fetchHeaders=function(g,b,c){var d,e,f,h;d=g.axis;e=g.start;f=g.count;e=Math.max(0,e);"column"===d?f=Math.min(this.columns.length,e+f):(h=this.hm(),f=void 0===this.kx?e:Math.min(h.length,e+f));d=new a.Gh(e,f,d,this);null!=b&&null!=b.success&&(null==c&&
(c={}),b.success.call(c.success,d,g,null))};a.b.g("ArrayDataGridDataSource.prototype.fetchHeaders",{fetchHeaders:a.ib.prototype.fetchHeaders});a.ib.prototype.Pta=function(a,b){var c=this.columns[b];return this.hm()[a][c]};a.ib.prototype.SCa=function(a,b,c){this.hm()[a][this.columns[b]]=c};a.ib.prototype.Qta=function(a,b){return{keys:{row:this.FJ(a),column:this.columns[b]}}};a.ib.prototype.fetchCells=function(g,b,c){var d,e,f,h,k,l;for(d=0;d<g.length;d+=1)e=g[d],"row"===e.axis?(f=e.start,h=Math.min(this.kt(),
f+e.count)):"column"===e.axis&&(k=e.start,l=Math.min(this.columns.length,k+e.count));void 0===h||void 0===l?null!=b&&null!=b.error&&(null==c&&(c={}),b.error.call(c.error)):(d=new a.yj(f,h,k,l,this),null!=b&&null!=b.success&&(null==c&&(c={}),b.success.call(c.success,d,g)))};a.b.g("ArrayDataGridDataSource.prototype.fetchCells",{fetchCells:a.ib.prototype.fetchCells});a.ib.prototype.keys=function(a){var b=a.row,c=a.column;return new Promise(function(a){a({row:this.FJ(b),column:this.columns[c]})}.bind(this))};
a.b.g("ArrayDataGridDataSource.prototype.keys",{keys:a.ib.prototype.keys});a.ib.prototype.indexes=function(a){var b=a.row,c=a.column;return new Promise(function(a){a({row:this.EJ(b),column:this.columns.indexOf(c)})}.bind(this))};a.b.g("ArrayDataGridDataSource.prototype.indexes",{indexes:a.ib.prototype.indexes});a.ib.prototype.sort=function(a,b,c){var d=[],e=[],f;null!=b&&null==c&&(c={});void 0==this.ex&&(this.wAa=this.sortCriteria,this.ex=this.data.slice());null==a?a=this.sortCriteria:this.sortCriteria=
a;if(null==a)this.dW(b,c);else if(f=a.axis,a=a.key,"column"===f)this.hm().sort(this.$C()),null!=b&&null!=b.success&&b.success.call(c.success);else if("row"===f){a=this.EJ(a);for(f=0;f<this.columns.length;f+=1)d[f]=this.hm()[a][this.columns[f]];d.sort(this.$C());for(f=0;f<this.columns.length;f+=1)e[f]=this.columns[d.indexOf(this.hm()[a][this.columns[f]])];this.yia=this.columns;this.columns=e;null!=b&&null!=b.success&&b.success.call(c.success)}else null!==b&&null!=b.error&&b.error.call(c.error,"Invalid axis value")};
a.b.g("ArrayDataGridDataSource.prototype.sort",{sort:a.ib.prototype.sort});a.ib.prototype.dW=function(a,b){null!=this.ex&&(this.data=this.ex,this.sortCriteria=this.wAa);null!=this.yia&&(this.columns=this.yia);null!=a&&null!=a.success&&a.success.call(b.success)};a.ib.prototype.getCapability=function(a){return"sort"===a?"column":"move"===a?"row":null};a.b.g("ArrayDataGridDataSource.prototype.getCapability",{getCapability:a.ib.prototype.getCapability});a.ib.prototype.$C=function(){var a,b,c;a=this.comparator;
return null==a?(a=this.sortCriteria.key,b=this.sortCriteria.direction,c=this.sortCriteria.axis,this.aAa(b,a,c)):a};a.ib.prototype.aAa=function(a,b,c){if("ascending"===a)return function(a,e){var f,g;void 0!=b&&"column"==c&&(a instanceof Array?(a=a[parseInt(b,10)],e=e[parseInt(b,10)]):(a=a[b],e=e[b]));f=isNaN(a);g=isNaN(e);a instanceof Date&&(a=a.toISOString(),f=!0);e instanceof Date&&(e=e.toISOString(),g=!0);return f&&g?a<e?-1:a===e?0:1:f?1:g?-1:a-e};if("descending"===a)return function(a,e){var f,
g;void 0!=b&&"column"==c&&(a instanceof Array?(a=a[parseInt(b,10)],e=e[parseInt(b,10)]):(a=a[b],e=e[b]));f=isNaN(a);g=isNaN(e);a instanceof Date&&(a=a.toISOString(),f=!0);e instanceof Date&&(e=e.toISOString(),g=!0);return f&&g?a>e?-1:a===e?0:1:f?-1:g?1:e-a}};a.ib.prototype.move=function(a,b){var c,d;c=this.EJ(a);d=this.data.splice(c,1)[0];this.data instanceof Array&&(c=this.Io("delete",a,null,c,-1,!0),this.handleEvent("change",c));null===b?(this.data.push(d),c=this.data.length-1):(c=this.EJ(b),this.data.splice(c,
0,d));this.data instanceof Array&&(c=this.Io("insert",a,null,c,-1),this.handleEvent("change",c));null!=this.ex&&(this.ex=this.data.slice())};a.b.g("ArrayDataGridDataSource.prototype.move",{move:a.ib.prototype.move});a.ib.prototype.moveOK=function(){return"valid"};a.b.g("ArrayDataGridDataSource.prototype.moveOK",{moveOK:a.ib.prototype.moveOK});a.ib.prototype.hm=function(){return"function"===typeof this.data?this.data():this.data};a.ib.prototype.EJ=function(a){var b,c=this.hm();for(b=0;b<c.length;b++)if(c[b].ojKey===
a)return b;return-1};a.ib.prototype.FJ=function(a){var b=this.hm();return b[a]?b[a].ojKey:null};a.ib.prototype.Io=function(a,b,c,d,e,f){var h={source:this};h.operation=a;h.keys={row:b,column:c};h.indexes={row:d,column:e};h.silent=f;return h};a.ib.prototype.jEa=function(a){var b,c,d,e=!1;c=!1;var f=[],h=[];for(b=0;b<a.length;b++){d=a[b];if(void 0!==d.moved){c=!0;d=this.Io("refresh",null,null);this.handleEvent("change",d);break}"added"===d.status&&(e=!0)}if(!c){for(b=0;b<a.length;b++)d=a[b],"deleted"===
d.status&&(c=d.value,d=d.index,c=c.ojKey,f.push({row:c,column:-1}),h.push({row:d,column:-1}));0<f.length&&(d={source:this,operation:"delete",keys:f,indexes:h,silent:e},this.handleEvent("change",d));for(b=0;b<a.length;b++)d=a[b],"added"===d.status&&(c=d.value,d=d.index,null==c.ojKey&&(c.ojKey=this.Rw.toString(),this.Rw++),c=c.ojKey,d=this.Io("insert",c,null,d,-1),this.handleEvent("change",d))}null!=this.ex&&(this.ex=this.data.slice())};a.ib.prototype.kt=function(){return this.hm().length};a.ib.prototype.mga=
function(){return this.kx};a.b.g("ArrayDataGridDataSource.prototype.getRowHeaderKey",{mga:a.ib.prototype.mga});a.ib.prototype.Ct=function(){return this.columns};a.b.g("ArrayDataGridDataSource.prototype.getColumns",{Ct:a.ib.prototype.Ct});a.ib.prototype.getData=function(){return this.data};a.b.g("ArrayDataGridDataSource.prototype.getData",{getData:a.ib.prototype.getData});a.Gh=function(a,b,c,d){this.fd=a;this.rg=b;this.Hha=c;this.lm=d};o_("ArrayHeaderSet",a.Gh,a);a.Gh.prototype.getData=function(g,
b){if(null==this.lm)return null;a.o.assert(g<=this.rg&&g>=this.fd,"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return this.lm.kT(this.Hha,g)};a.b.g("ArrayHeaderSet.prototype.getData",{getData:a.Gh.prototype.getData});a.Gh.prototype.getMetadata=function(g,b){if(null==this.lm)return null;a.o.assert(g<=this.rg&&g>=this.fd,"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return this.lm.yua(this.Hha,g)};a.b.g("ArrayHeaderSet.prototype.getMetadata",{getMetadata:a.Gh.prototype.getMetadata});
a.Gh.prototype.getLevelCount=function(){return 0<this.getCount()?1:0};a.b.g("ArrayHeaderSet.prototype.getLevelCount",{getLevelCount:a.Gh.prototype.getLevelCount});a.Gh.prototype.getExtent=function(g,b){a.o.assert(g<=this.rg&&g>=this.fd,"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return{extent:1,more:{before:!1,after:!1}}};a.b.g("ArrayHeaderSet.prototype.getExtent",{getExtent:a.Gh.prototype.getExtent});a.Gh.prototype.getDepth=function(g,b){a.o.assert(g<=this.rg&&g>=this.fd,
"index out of bounds");a.o.assert(null==b||0==b,"level out of bounds");return 1};a.b.g("ArrayHeaderSet.prototype.getDepth",{getDepth:a.Gh.prototype.getDepth});a.Gh.prototype.getCount=function(){return null==this.lm?0:Math.max(0,this.rg-this.fd)};a.b.g("ArrayHeaderSet.prototype.getCount",{getCount:a.Gh.prototype.getCount});a.Gh.prototype.getStart=function(){return this.fd};a.b.g("ArrayHeaderSet.prototype.getStart",{getStart:a.Gh.prototype.getStart});a.yj=function(a,b,c,d,e){this.za=a;this.kb=b;this.Jp=
c;this.Tw=d;this.lm=e};o_("ArrayCellSet",a.yj,a);a.yj.prototype.getData=function(a){var b,c,d;b=this;c=a.row;d=a.column;a={};Object.defineProperty(a,"data",{get:function(){return b.lm.Pta(c,d)},set:function(a){b.lm.SCa(c,d,a)}});return a};a.b.g("ArrayCellSet.prototype.getData",{getData:a.yj.prototype.getData});a.yj.prototype.getMetadata=function(a){return this.lm.Qta(a.row,a.column)};a.b.g("ArrayCellSet.prototype.getMetadata",{getMetadata:a.yj.prototype.getMetadata});a.yj.prototype.getStart=function(a){return"row"==
a?this.za:"column"==a?this.Jp:-1};a.b.g("ArrayCellSet.prototype.getStart",{getStart:a.yj.prototype.getStart});a.yj.prototype.getCount=function(a){return"row"===a?Math.max(0,this.kb-this.za):"column"===a?Math.max(0,this.Tw-this.Jp):0};a.b.g("ArrayCellSet.prototype.getCount",{getCount:a.yj.prototype.getCount});a.yj.prototype.yp=function(){return this.za};a.b.g("ArrayCellSet.prototype.getStartRow",{yp:a.yj.prototype.yp});a.yj.prototype.xp=function(){return this.Jp};a.b.g("ArrayCellSet.prototype.getStartColumn",
{xp:a.yj.prototype.xp})});