/**
 * Copyright (c) 2014, 2016, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
/*
 Copyright 2013 jQuery Foundation and other contributors
 Released under the MIT license.
 http://jquery.org/license
*/
define(["ojs/ojcore","jquery","ojs/ojdatasource-common"],function(b){b.nb=function(f,a){a=a||{};if(!(f instanceof b.ca))throw Error(b.T.ec._ERR_DATA_INVALID_TYPE_SUMMARY+"\n"+b.T.ec._ERR_DATA_INVALID_TYPE_DETAIL);this.i=f;this.hd=[];this.$=0;this.eo=[];null==this.i.Dy("fetchSize")&&(this.i.GN=function(){return-1});var d=this;this.i.nE=function(a,e,f){var h,k,l,m=[],n=[],p=[];for(e=0;e<f.R();e++)h=f.getData(e),l=f.getMetadata(e).key,k=a+e,d.eo[k]={},d.eo[k].nodeSet=f,d.eo[k].startIndex=a,m.push(h),
n.push(l),p.push(k),d.qa.data.splice(k,0,h),d.qa.keys.splice(k,0,l),d.qa.indexes.splice(k,0,k);d.La||b.T.q.handleEvent.call(d,b.T.D.ADD,{data:m,keys:n,indexes:p});d.Ex();d.La&&setTimeout(function(){d.fetch()},0)};this.i.ME=function(a){var e,f,h=[],k=[],l=[];for(e=0;e<a.length;e++)f=a[e].index-e,h.push(""),k.push(""),l.push(f),d.qa.data.splice(f,1),d.qa.keys.splice(f,1),d.qa.indexes.splice(f,1);d.La||b.T.q.handleEvent.call(d,b.T.D.REMOVE,{data:h,keys:k,indexes:l});d.Ex();d.La&&setTimeout(function(){d.fetch()},
0)};this.Init();if(null!=a&&("enabled"==a.startFetch||null==a.startFetch)||null==a)this.Vx=!0};o_("FlattenedTreeTableDataSource",b.nb,b);b.b.ga(b.nb,b.T,"oj.FlattenedTreeTableDataSource");b.nb.prototype.Init=function(){b.nb.q.Init.call(this)};b.b.g("FlattenedTreeTableDataSource.prototype.Init",{Init:b.nb.prototype.Init});b.nb.prototype.getCapability=function(){return"full"};b.b.g("FlattenedTreeTableDataSource.prototype.getCapability",{getCapability:b.nb.prototype.getCapability});b.nb.prototype.getWrappedDataSource=
function(){return this.i};b.b.g("FlattenedTreeTableDataSource.prototype.getWrappedDataSource",{getWrappedDataSource:b.nb.prototype.getWrappedDataSource});b.nb.prototype.fetch=function(b){b=b||{};return"init"!=b.fetchType||this.Vx?this.De(b):Promise.resolve()};b.b.g("FlattenedTreeTableDataSource.prototype.fetch",{fetch:b.nb.prototype.fetch});b.nb.prototype.at=function(b){var a;a=0>b||b>=this.qa.length?null:{data:this.qa.data[b],index:b,key:this.qa.keys[b]};return new Promise(function(b){b(a)})};b.b.g("FlattenedTreeTableDataSource.prototype.at",
{at:b.nb.prototype.at});b.nb.prototype.collapse=function(b){this.i.collapse(b)};b.b.g("FlattenedTreeTableDataSource.prototype.collapse",{collapse:b.nb.prototype.collapse});b.nb.prototype.expand=function(b){this.i.expand(b)};b.b.g("FlattenedTreeTableDataSource.prototype.expand",{expand:b.nb.prototype.expand});b.nb.prototype.get=function(){b.l.Xb();return null};b.b.g("FlattenedTreeTableDataSource.prototype.get",{get:b.nb.prototype.get});b.nb.prototype.on=function(f,a){if("expand"==f||"collapse"==f)this.i.on(f,
a);else b.nb.q.on.call(this,f,a)};b.b.g("FlattenedTreeTableDataSource.prototype.on",{on:b.nb.prototype.on});b.nb.prototype.off=function(f,a){"expand"==f||"collapse"==f?this.i.off(f,a):b.nb.q.off.call(this,f,a)};b.b.g("FlattenedTreeTableDataSource.prototype.off",{off:b.nb.prototype.off});b.nb.prototype.sort=function(f){if(null==f)return Promise.resolve();var a=this;f.axis="column";return new Promise(function(d,c){a.i.getWrappedDataSource().sort(f,{success:function(){setTimeout(function(){a.i.refresh();
a.qa=null;var c={header:f.key,direction:f.direction};b.T.q.handleEvent.call(a,b.T.D.SORT,c);d(c)},0)}.bind(this),error:function(a){c(a)}.bind(this)})})};b.b.g("FlattenedTreeTableDataSource.prototype.sort",{sort:b.nb.prototype.sort});b.nb.prototype.totalSize=function(){return-1};b.b.g("FlattenedTreeTableDataSource.prototype.totalSize",{totalSize:b.nb.prototype.totalSize});b.nb.prototype.iJ=function(b){return this.eo[b].nodeSet.getMetadata(b-this.eo[b].startIndex)};b.nb.prototype.De=function(f){f=f||
{};this.Ux(f);this.$=null==f.startIndex?this.$:f.startIndex;var a=Number.MAX_VALUE;this.La=null==f.pageSize?this.La:f.pageSize;null!=this.La&&(a=this.La);var d=this.$;if(null!=this.qa)if(null!=this.La){var c=this.qa.data.length-1;if(this.$+this.La-1<=c){var c=b.nb.FB(this.qa,this.$,this.La),a=[],d=[],e;for(e=this.$;e<=c;e++)a[e-this.$]=this.qa.data[e],d[e-this.$]="";c={data:a,keys:d,startIndex:this.$};this.ij(f,c,null);return Promise.resolve(c)}this.$<=c&&(d=c+1)}else this.i.refresh(),this.qa=null;
var g={start:d,count:a},h=this;return new Promise(function(a,c){h.i.Ho(g,{success:function(c){h.PJ(c);f.refresh=!0;var d=b.nb.FB(h.qa,h.$,h.La),e=[],g=[],l;for(l=h.$;l<=d;l++)e[l-h.$]=h.qa.data[l],g[l-h.$]=c.getMetadata(l).key;c={data:e,keys:g,startIndex:h.$};h.ij(f,c,null);a(c)}.bind(this),error:function(a){h.ij(f,null,a);c(a)}.bind(this)})})};b.nb.prototype.PJ=function(f){var a,d;for(a=0;a<f.R();a++)d=this.$+a,this.eo[d]={},this.eo[d].nodeSet=f,this.eo[d].startIndex=this.$;this.qa||(this.qa={},
this.qa.data=[],this.qa.keys=[],this.qa.indexes=[]);b.nb.qt(f,this,this.qa)};b.nb.prototype.Ux=function(f){f.silent||b.T.q.handleEvent.call(this,b.T.D.REQUEST,{startIndex:f.startIndex})};b.nb.prototype.ij=function(f,a,d){null!=d?b.T.q.handleEvent.call(this,b.T.D.ERROR,d):f.silent||b.T.q.handleEvent.call(this,b.T.D.SYNC,a)};b.nb.FB=function(b,a,d){var c=b.data.length-1;0<d&&(c=a+d-1,c=c>b.data.length-1?b.data.length-1:c);return c};b.nb.qt=function(b,a,d){a=b.R()-1;var c;for(c=b.ta();c<=a;c++){var e=
b.getData(c);d.data[c]=e;d.keys[c]="";d.indexes[c]=c}};b.nb.prototype.Ex=function(){for(var b=0;b<this.qa.data.length;b++)this.qa.indexes[b]=b}});